{"ts":1372467412318,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"# Place all the behaviors and hooks related to the matching controller here.\n# All this logic will automatically be available in application.js.\n# You can use CoffeeScript in this file: http://jashkenas.github.com/coffee-script/\n\n$(($)->\n  $('#form_calc')\n    .live(\"ajax:complete\", (xhr)->\n      #alert(\"done\")\n      #$('#result').append('<div>Done.</div>')\n    )\n    .live(\"ajax:beforeSend\", (xhr)->\n      $('#result').html('<div>Loading...</div>')\n    )\n    .live(\"ajax:success\", (event, data, status, xhr)->\n      output_html=\"\"\n      [output_html, total1, total2] = hardware(data['hw'])\n      output_html += software(data['sw'], total1, total2)\n      output_html += outsource(data['outsource'], total1+total2)\n      output_html += fte(data['fte'], total1+total2)\n\n      $('#result').html(output_html)\n    )\n    .live(\"ajax:error\", (data, status, xhr)->\n      alert(\"failure!!!\")\n    )\n)\n\nhardware=(data)->\n      total1=0\n      total2=0\n      cost=0\n      html = \"<table id='result_tbl' class='result_tbl'>\"\n      html += '''\n            <col class=\"vm type\" />\n            <col class=\"num(prod)\" />\n            <col class=\"num(non-prod)\" />\n            <col class=\"cost(prod)\" />\n            <col class=\"cost(non-prod)\" />\n            <tr>\n            <td class=title colspan=5 align=center>hardware</td>\n            </tr>\n            <tr>\n            <th>hw item</th>\n            <th>num(prod)</th>\n            <th>num(non-prod)</th>\n            <th>arc(prod)</th>\n            <th>arc(non-prod)</th>\n            </tr>\n'''\n      for o in data\n        if o['num1'] isnt \"0\" or o['num2'] isnt \"0\"\n          html += \"<tr><td>#{o['item']}(#{o['spec']})</td>\"\n          html += \"<td>#{o['num1']}</td>\"\n          html += \"<td>#{o['num2']}</td>\"\n          html += \"<td>#{o['cost1']}</td>\"\n          html += \"<td>#{o['cost2']}</td></tr>\"\n          total1 += parseInt(o['num1'])\n          total2 += parseInt(o['num2'])\n\n      html += \"<tr><td>total arc</td><td colspan=4>\"\n      html += o['total_cost']\n      html += \"</td></tr>\"\n      html += \"</table>\"\n      [html,total1,total2]\n    \nsoftware=(data, n1, n2)->\n      html = \"<table id='result_tbl' class='result_tbl'>\"\n      html += \"\"\"\n            <tr>\n            <td class=title colspan=4 align=center>software</td>\n            </tr>\n            <tr>\n            <th>sw item</th>\n            <th>num</th>\n            <th>init</th>\n            <th>arc</th>\n            </tr>\n\"\"\"\n      for o in data\n        if n1 isnt 0 or n2 isnt 0\n          html += \"<tr><td>#{o['item']}</td>\"\n          html += \"<td>#{o['num']}</td>\"\n          html += \"<td>#{o['init']}</td>\"\n          html += \"<td>#{o['recr']}</td></tr>\"\n\n      html += \"<tr><td colspan=2>total</td>\"\n      html += \"<td>#{o['cost_init']}</td>\"\n      html += \"<td>#{o['cost_recr']}</td></tr>\"\n      html += \"</table>\"\n\nfte=(data, n)->\n      html = \"<table id='result_tbl' class='result_tbl'>\"\n      o = data[0]\n\n      html += \"\"\"\n            <tr>\n            <td class=title colspan=5 align=center>fte</td>\n            </tr>\n            <tr>\n            <th>resource</th>\n            <th>phase 2</th>\n            <th>phase 3</th>\n            <th>phase 4</th>\n            <th>recurring</th>\n            </tr>\n            <tr>\n            <td>#{o['item']}</td>\n            <td>#{o['ph2']}</td>\n            <td>#{o['ph3']}</td>\n            <td>#{o['ph4']}</td>\n            <td>#{o['arc']}</td>\n            </tr>\n            </table>\n\"\"\"\n\noutsource=(data, n)->\n      html = \"<table id='result_tbl' class='result_tbl'>\"\n      o = data[0]\n\n      html += \"\"\"\n            <tr>\n            <td class=title colspan=2 align=center>outsource service</td>\n            </tr>\n            <tr>\n            <th>outsource</th>\n            <th>cost</th>\n            </tr>\n            <tr>\n            <td>#{o['item']}</td>\n            <td>#{o['init']}</td>\n            </tr>\n            </table>\n\"\"\"\n"]],"start1":0,"start2":0,"length1":0,"length2":3884}]],"length":3884}
